"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6817],{76817:(e,n,i)=>{i.r(n),i.d(n,{SpendingLimitFields:()=>$,default:()=>q});var t=i(74848),s=i(78562),r=i(73721),l=i(96540),d=i(49785),o=i(39324);let a=(0,i(57657).A)((0,t.jsx)("path",{d:"M15.88 9.29 12 13.17 8.12 9.29a.996.996 0 0 0-1.41 0c-.39.39-.39 1.02 0 1.41l4.59 4.59c.39.39 1.02.39 1.41 0l4.59-4.59c.39-.39.39-1.02 0-1.41-.39-.38-1.03-.39-1.42 0"}),"ExpandMoreRounded");var c=i(95508),m=i(76482),u=i(80063),x=i(83936),h=i(29474),f=i(86943),j=i(96389),p=i(6054),v=i.n(p),b=i(13168),A=i(74525);let g=(e,n)=>{try{let i=(0,c.XS)(e,null!=n?n:"Gwei");m.y.defaultAbiCoder().encode(["int96"],[i])}catch(n){return Number(e)>1?"Amount is too big":"Amount is too small"}},y=e=>{let{params:n,onSubmit:i}=e,s=(0,x.Ay)(),{balances:r}=(0,f.x)(),c=(0,l.useMemo)(()=>(0,h.$c)(s),[s]),m=(0,d.mN)({defaultValues:n,mode:"onChange"}),{handleSubmit:p,watch:y,control:k}=m,I=y($.tokenAddress),T=I?r.items.find(e=>e.tokenInfo.address===I):void 0,E=(0,l.useCallback)(e=>(0,A.bA)(e)||(0,A.EE)(e,null==T?void 0:T.tokenInfo.decimals)||g(e,null==T?void 0:T.tokenInfo.decimals),[null==T?void 0:T.tokenInfo.decimals]);return(0,t.jsx)(j.A,{children:(0,t.jsx)(d.Op,{...m,children:(0,t.jsxs)("form",{onSubmit:p(i),children:[(0,t.jsx)(o.MJN,{fullWidth:!0,sx:{mb:3},children:(0,t.jsx)(u.A,{"data-testid":"beneficiary-section",name:$.beneficiary,label:"Beneficiary"})}),(0,t.jsx)(b.A,{balances:r.items,selectedToken:T,validate:E}),(0,t.jsx)(o.o5u,{variant:"h4",fontWeight:700,mt:3,children:"Reset Timer"}),(0,t.jsx)(o.o5u,{children:"Set a reset time so the allowance automatically refills after the defined time period."}),(0,t.jsxs)(o.MJN,{fullWidth:!0,className:v().select,children:[(0,t.jsx)(o.l1Y,{shrink:!1,children:"Time Period"}),(0,t.jsx)(d.xI,{rules:{required:!0},control:k,name:$.resetTime,render:e=>{let{field:n}=e;return(0,t.jsx)(o.l6P,{"data-testid":"time-period-section",...n,sx:{textAlign:"right",fontWeight:700},IconComponent:a,children:c.map(e=>(0,t.jsx)(o.Drp,{"data-testid":"time-period-item",value:e.value,sx:{overflow:"hidden"},children:e.label},e.value))})}})]}),(0,t.jsx)(o.waF,{children:(0,t.jsx)(o.$nd,{"data-testid":"next-btn",variant:"contained",type:"submit",children:"Next"})})]})})})};var k=i(56332),I=i(6459),T=i(71468),E=i(15657),S=i(1125),w=i(68879),M=i(13859),N=i(10256),C=i(57117),D=i(28462),_=i(31243),F=i(73536),O=i(68130);let R=e=>{var n;let{params:i}=e,s=(0,T.d4)(D.h4),{safe:r}=(0,I.A)(),d=(0,x.Ay)(),a=(0,k._J)(),{balances:c}=(0,M.A)(),{setSafeTx:m,setSafeTxError:u}=(0,l.useContext)(O.H),f=c.items.find(e=>e.tokenInfo.address===i.tokenAddress),{decimals:j}=(null==f?void 0:f.tokenInfo)||{},p=(0,l.useMemo)(()=>{var e;return(null===(e=(0,_.wy)(i.amount,null==f?void 0:f.tokenInfo.decimals))||void 0===e?void 0:e.toString())||"0"},[i.amount,null==f?void 0:f.tokenInfo.decimals]),v=(0,l.useMemo)(()=>s.find(e=>e.beneficiary===i.beneficiary&&e.token.address===i.tokenAddress),[s,i]);(0,l.useEffect)(()=>{a&&(0,C.S0)(i,s,d,a,r.modules,r.deployed,j,v).then(m).catch(u)},[a,d,j,v,i,r.modules,r.deployed,m,u,s]);let b="0"===i.resetTime,A=(0,l.useMemo)(()=>{var e;return b?"One-time spending limit":null===(e=(0,h.$c)(d).find(e=>e.value===i.resetTime))||void 0===e?void 0:e.label},[b,i.resetTime,d]),g=v?(0,_.q5)(BigInt(null==v?void 0:v.amount),j):void 0,y=v?null===(n=(0,h.$c)(d).find(e=>e.value===(null==v?void 0:v.resetTimeMin)))||void 0===n?void 0:n.label:void 0;return(0,t.jsxs)(w.A,{onSubmit:()=>{(0,N.sx)({...N.kd.SPENDING_LIMIT.RESET_PERIOD,label:A})},children:[f&&(0,t.jsx)(S.A,{amountInWei:p,tokenInfo:f.tokenInfo,title:"Amount",children:g&&g!==i.amount&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.o5u,{"data-testid":"old-token-amount",color:"error",sx:{textDecoration:"line-through"},component:"span",children:g}),"→"]})}),(0,t.jsxs)(o.xA9,{container:!0,sx:{gap:1,alignItems:"center"},children:[(0,t.jsx)(o.xA9,{item:!0,md:!0,children:(0,t.jsx)(o.o5u,{variant:"body2",sx:{color:"text.secondary"},children:"Beneficiary"})}),(0,t.jsx)(o.xA9,{"data-testid":"beneficiary-address",item:!0,md:10,children:(0,t.jsx)(F.A,{address:i.beneficiary,shortAddress:!1,hasExplorer:!0,showCopyButton:!0,showAvatar:!1})})]}),(0,t.jsxs)(o.xA9,{container:!0,sx:{gap:1,alignItems:"center"},children:[(0,t.jsx)(o.xA9,{item:!0,md:!0,children:(0,t.jsx)(o.o5u,{variant:"body2",sx:{color:"text.secondary"},children:"Reset time"})}),(0,t.jsx)(o.xA9,{item:!0,md:10,children:v?(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(E.A,{label:(0,t.jsxs)(t.Fragment,{children:[v.resetTimeMin!==i.resetTime&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.o5u,{"data-testid":"old-reset-time",color:"error",component:"span",sx:{display:"inline",textDecoration:"line-through"},children:y})," → "]}),(0,t.jsx)(o.o5u,{component:"span",sx:{display:"inline"},children:A})]}),isOneTime:"0"===v.resetTimeMin})}):(0,t.jsx)(E.A,{"data-testid":"spending-limit-label",label:A||"One-time spending limit",isOneTime:!!A&&b})})]}),v&&(0,t.jsx)(o.FcD,{severity:"warning",sx:{border:"unset"},children:(0,t.jsx)(o.o5u,{"data-testid":"limit-replacement-warning",sx:{fontWeight:700},children:"You are about to replace an existing spending limit"})})]})};var W=i(8109),B=i(29806),P=function(e){return e.beneficiary="beneficiary",e.resetTime="resetTime",e}(P||{});let $={...P,...b.p},J={beneficiary:"",tokenAddress:B.ZERO_ADDRESS,amount:"",resetTime:"0"},q=()=>{let{data:e,step:n,nextStep:i,prevStep:l}=(0,r.A)(J),d=[(0,t.jsx)(y,{params:e,onSubmit:n=>i({...e,...n})},0),(0,t.jsx)(R,{params:e},1)];return(0,t.jsx)(s.A,{title:0===n?"New transaction":"Confirm transaction",subtitle:"Spending limit",icon:W.A,step:n,onBack:l,children:d})}}}]);
//# sourceMappingURL=6817.d52dfb1722567f1f.js.map