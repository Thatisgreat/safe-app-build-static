"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6780],{51955:(e,n,a)=>{a.d(n,{S:()=>v,A:()=>h});var t=a(96540),s=a(12612),r=a(5699),i=a(55155);class l{constructor(e,n){var a=this;this.handlers=new Map,this.on=(e,n)=>{this.handlers.set(e,n)},this.isValidMessage=e=>{var n;if(!e.data)return!1;if(e.data.hasOwnProperty("isCookieEnabled"))return!0;let a=(null===(n=this.iframeRef.current)||void 0===n?void 0:n.contentWindow)===e.source,t=Object.values(r.PJ).includes(e.data.method),s="getCurrentTheme"===e.data.method;return a&&(t||s)},this.canHandleMessage=e=>!!e.data&&!!this.handlers.get(e.data.method),this.send=function(e,n){var t,s;let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=(0,r.D6)(),o=i?r.ES.makeErrorResponse(n,e,l):r.ES.makeResponse(n,e,l);null===(s=a.iframeRef.current)||void 0===s||null===(t=s.contentWindow)||void 0===t||t.postMessage(o,"*")},this.handleIncomingMessage=async e=>{let n=this.isValidMessage(e),a=this.canHandleMessage(e);if(n&&a){var t,s,r,l;let n=this.handlers.get(e.data.method);null===(s=this.config)||void 0===s||null===(t=s.onMessage)||void 0===t||t.call(s,e);try{let a=await n(e);void 0!==a&&this.send(a,e.data.id)}catch(a){let n=(0,i.z)(a);this.send(n.message,e.data.id,!0),null===(l=this.config)||void 0===l||null===(r=l.onError)||void 0===r||r.call(l,n,e.data)}}},this.clear=()=>{window.removeEventListener("message",this.handleIncomingMessage),this.handlers.clear()},this.iframeRef=e,this.config=n||{},window.addEventListener("message",this.handleIncomingMessage)}}var o=a(21886),d=a(10256),u=a(65605),c=a(42837),g=a(28213),f=a(6897),v=function(e){return e.REJECT_TRANSACTION_MESSAGE="Transaction was rejected",e}({});let h=(e,n,a,i)=>{let[v,h]=(0,t.useState)(void 0),m=(0,u.GV)(c._G),S=(0,f.D)(),p=(0,t.useMemo)(()=>{if(a)return(0,g.Sr)(a,null==m?void 0:m[a.chainId])},[a,m]);return(0,t.useEffect)(()=>{let a;return n&&((e,n)=>{h(a=new l(e,{onMessage:e=>{var a;if(!e.data)return;let t=n&&n.id<1;(0,d.ai)({...d.Jz.SAFE_APP_SDK_METHOD_CALL},t?null==n?void 0:n.url:(null==n?void 0:n.name)||"",{method:e.data.method,ethMethod:null===(a=e.data.params)||void 0===a?void 0:a.call,version:e.data.env.sdkVersion})},onError:e=>{(0,o.vV)(o.I._901,e.message)}}))})(e,n),()=>{null==a||a.clear()}},[n,e]),(0,t.useEffect)(()=>{let e=Math.random().toString(36).slice(2);null==v||v.send({darkMode:S},e)},[v,S]),(0,t.useEffect)(()=>{null==v||v.on(r.PJ.getTxBySafeTxHash,e=>{let{safeTxHash:n}=e.data.params;return i.onGetTxBySafeTxHash(n)}),null==v||v.on(r.PJ.getEnvironmentInfo,i.onGetEnvironmentInfo),null==v||v.on(r.PJ.getSafeInfo,i.onGetSafeInfo),null==v||v.on(r.PJ.getSafeBalances,e=>{let{currency:n="usd"}=e.data.params;return i.onGetSafeBalances(n)}),null==v||v.on(r.PJ.rpcCall,async e=>{let n=e.data.params;if(n.call===r.Y_.safe_setSettings){let e=n.params[0];return i.onSetSafeSettings(e)}if(!p)throw Error("SafeAppWeb3Provider is not initialized");try{return await p.send(n.call,n.params)}catch(e){throw Error(e.error)}}),null==v||v.on(r.PJ.sendTransactions,e=>{let{txs:n,params:a}=e.data.params,t=n.map(e=>{let{to:n,value:a,data:t}=e;return{to:(0,s.b)(n),value:a?BigInt(a).toString():"0",data:t||"0x"}});i.onConfirmTransactions(t,e.data.id,a)}),null==v||v.on(r.PJ.signMessage,e=>{let{message:n}=e.data.params,a=e.data.env.sdkVersion;i.onSignMessage(n,e.data.id,r.PJ.signMessage,a)}),null==v||v.on(r.PJ.getOffChainSignature,e=>i.onGetOffChainSignature(e.data.params)),null==v||v.on(r.PJ.signTypedMessage,e=>{let{typedData:n}=e.data.params,a=e.data.env.sdkVersion;i.onSignMessage(n,e.data.id,r.PJ.signTypedMessage,a)}),null==v||v.on(r.PJ.getChainInfo,i.onGetChainInfo),null==v||v.on(r.PJ.wallet_getPermissions,e=>i.onGetPermissions(e.origin)),null==v||v.on(r.PJ.wallet_requestPermissions,e=>{i.onSetPermissions({origin:e.origin,request:e.data.params,requestId:e.data.id})}),null==v||v.on(r.PJ.requestAddressBook,e=>i.onRequestAddressBook(e.origin)),null==v||v.on("getCurrentTheme",e=>{v.send({darkMode:S},e.data.id)})},[p,i,a,v,S]),v}},9393:(e,n,a)=>{a.d(n,{A:()=>u});var t=a(96540),s=a(83936),r=a(56332),i=a(72040),l=a(6459),o=a(37185),d=a(30488);let u=()=>{var e;let{safe:n,safeAddress:a}=(0,l.A)(),u=(0,i.A)(),c=(0,d.Y)(),g=(0,s.Ay)(),f=(0,r._J)(),v=(null==f?void 0:f.chainName)||"";return(0,t.useCallback)(()=>{var e,t;return{safeAddress:a,chainId:parseInt(g,10),owners:n.owners.map(e=>e.value),threshold:n.threshold,isReadOnly:!u&&(null==c||0===c.length),nonce:n.nonce,implementation:n.implementation.value,modules:n.modules?n.modules.map(e=>e.value):null,fallbackHandler:n.fallbackHandler?null===(e=n.fallbackHandler)||void 0===e?void 0:e.value:null,guard:(null===(t=n.guard)||void 0===t?void 0:t.value)||null,version:n.version,network:(0,o.qb)(v||"",g).toUpperCase()}},[a,g,n.owners,n.threshold,n.nonce,n.implementation.value,n.modules,n.fallbackHandler,null===(e=n.guard)||void 0===e?void 0:e.value,n.version,u,c,v])}},37185:(e,n,a)=>{a.d(n,{$z:()=>f,EZ:()=>g,MU:()=>u,UW:()=>v,Xz:()=>m,iR:()=>h,qb:()=>c,vZ:()=>d});var t=a(85765),s=a(7598),r=a(8442);a(31243);var i=a(74525),l=a(11100);let o=e=>!!(["string","number"].includes(typeof e.value)&&("string"!=typeof e.value||/^(0x)?[0-9a-f]+$/i.test(e.value)))&&void 0===(0,i.jl)(e.to)&&!!e.data&&"string"==typeof e.data,d=e=>e.length>0&&e.every(e=>o(e)),u=e=>{if((0,t.Lo)(e))try{return(0,s._v)(e)}catch(e){}return e},c=(e,n)=>{let a=e;switch(n){case"1":a="MAINNET";break;case"100":a="XDAI"}return a},g=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1?arguments[1]:void 0;return{id:Math.round(1e9*Math.random()+1e6),url:e,name:"unknown",iconUrl:"/images/apps/apps-icon.svg",description:"",chainIds:[],accessControl:{type:r.SafeAppAccessPolicyTypes.NoRestrictions},tags:[],features:[],developerWebsite:"",socialProfiles:[],...n,safeAppsPermissions:[]}},f=e=>{if(!e)return"";let{origin:n}=new URL(e);return n},v=e=>{var n;return null===(n=e.features)||void 0===n?void 0:n.includes(r.SafeAppFeatures.BATCHED_TRANSACTIONS)},h=e=>{let n=Object.values(l.a4);return e.filter(e=>!n.some(n=>e===n))},m=e=>h(Array.from(e.reduce((e,n)=>(n.tags.forEach(n=>e.add(n)),e),new Set))).sort()},86780:(e,n,a)=>{a.d(n,{J:()=>T});var t=a(74848),s=a(96540),r=a(51955),i=a(88813),l=a(63304),o=a(8442),d=a(9393),u=a(79296),c=a(10804),g=a(50988),f=a(42837),v=a(65605),h=a(6459),m=a(32121),S=a(10256),p=a(57279),E=a(29719),A=a(83936),P=a(13859);let T=(e,n,a,T)=>{let[C,I]=(0,s.useState)(),M=(0,v.GV)(m.qg),{setTxFlow:_}=(0,s.useContext)(g.P),{safe:w,safeAddress:R}=(0,h.A)(),y=(0,v.GV)(f.gB),[J,G]=(0,s.useState)({offChainSigning:!0}),k=()=>{I(e=>{e&&(null==x||x.send(r.S.REJECT_TRANSACTION_MESSAGE,e,!0),(0,S.ai)(S.Jz.PROPOSE_TRANSACTION_REJECTED,n.name))})},N=(0,v.GV)(f.Eo),O=(0,A.Ay)(),{balances:b}=(0,P.A)(),x=(0,r.A)(e,n,a,{onConfirmTransactions:(e,a,s)=>{let r={app:n,appId:n?String(n.id):void 0,requestId:a,txs:e,params:s};I(a),(0,S.sx)({...S.Jz.OPEN_TRANSACTION_MODAL,label:n.name}),_((0,t.jsx)(i.Ad,{data:r}),k)},onSignMessage:(e,s,r,o)=>{let d=(0,l.qP)(w,a,o)&&!y&&!!J.offChainSigning;I(s),d?_((0,t.jsx)(i.Bd,{logoUri:(null==n?void 0:n.iconUrl)||"",name:(null==n?void 0:n.name)||"",message:e,origin:null==n?void 0:n.url,requestId:s}),k):_((0,t.jsx)(i.hL,{props:{app:n,requestId:s,message:e,method:r}}))},onGetPermissions:()=>[],onSetPermissions:()=>{},onRequestAddressBook:()=>[],onGetTxBySafeTxHash:e=>(0,o.getTransactionDetails)(O,e),onGetEnvironmentInfo:()=>({origin:document.location.origin}),onGetSafeInfo:(0,d.A)(),onGetSafeBalances:e=>{let n=a&&(0,u.jI)(a,u.Gv.DEFAULT_TOKENLIST);return w.deployed?(0,o.getBalances)(O,R,e,{exclude_spam:!0,trusted:n&&f.CG.TRUSTED===N}):Promise.resolve(b)},onGetChainInfo:()=>{if(!a)return;let{nativeCurrency:e,chainName:n,chainId:t,shortName:s,blockExplorerUriTemplate:r}=a;return{chainName:n,chainId:t,shortName:s,nativeCurrency:e,blockExplorerUriTemplate:r}},onSetSafeSettings:e=>{let n={...J,offChainSigning:!!e.offChainSigning};return G(n),n},onGetOffChainSignature:async e=>{var n,a,t;let s=null===(t=M.data)||void 0===t?void 0:null===(a=t.results)||void 0===a?void 0:null===(n=a.filter(c.a))||void 0===n?void 0:n.find(n=>n.messageHash===e);if(s)return s.preparedSignature;try{let{preparedSignature:n}=await (0,o.getSafeMessage)(O,e);return n}catch(e){return""}},...T});return(0,s.useEffect)(()=>(0,E.Vz)(E.hV.SAFE_APPS_REQUEST,async e=>{let{safeAppRequestId:a,safeTxHash:t}=e;a&&C===a&&((0,S.ai)(S.Jz.PROPOSE_TRANSACTION,null==n?void 0:n.name),null==x||x.send({safeTxHash:t},a))}),[O,x,C,n.name]),(0,s.useEffect)(()=>(0,p.dF)(p.Nd.SIGNATURE_PREPARED,e=>{let{messageHash:n,requestId:a,signature:t}=e;a&&C===a&&(null==x||x.send({messageHash:n,signature:t},a))}),[x,C]),x}}}]);
//# sourceMappingURL=6780-c56502af24f4ac40.js.map